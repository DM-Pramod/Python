<!DOCTYPE html>
<html>
<head>
  <title>Network Visualization</title>
  <style>
    #network {
      width: 100vw; /* Full width */
      height: 100vh; /* Full height */
      border: 1px solid lightgray;
    }
    .tooltip-table {
      border-collapse: collapse;
      width: 100%; /* Use relative width */
      font-size: 2vw; /* Increase font size relative to viewport width */
    }
    .tooltip-table th, .tooltip-table td {
      border: 1px solid black;
      padding: 1vw; /* Use relative padding */
      text-align: left;
    }
    .tooltip-table th {
      background-color: #f2f2f2;
    }
    .tooltip {
      position: absolute;
      background-color: white;
      border: 1px solid black;
      padding: 1vw; /* Use relative padding */
      z-index: 1000;
      max-width: 300px; /* Ensure tooltip doesn't exceed screen width */
      word-wrap: break-word; /* Ensure long text wraps */
      font-size: 2vw; /* Increase font size relative to viewport width */
    }
  </style>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
</head>
<body>
  <div id="network"></div>
  <script type="text/javascript">
    var nodes = {{ nodes | safe }};
    var edges = {{ edges | safe }};

    // Ensure edges have 'from' and 'to' properties
    edges = edges.map(edge => ({
      from: edge.From_NodeID,
      to: edge.Next_NodeID,
      label: edge.label,
      Vessel: edge.Vessel,
      DAYS: edge.DAYS
    }));

    var container = document.getElementById('network');
    var data = {
      nodes: new vis.DataSet(nodes),
      edges: new vis.DataSet(edges)
    };
    var options = {
      nodes: {
        shape: 'dot',
        size: 16,
        font: {
          size: 32,
          color: '#ffffff'
        },
        borderWidth: 2
      },
      edges: {
        width: 2
      },
      interaction: {
        hover: true
      },
      physics: {
        stabilization: false
      }
    };
    var network = new vis.Network(container, data, options);

    network.on("hoverNode", function (params) {
      var node = nodes.find(n => n.id === params.node);
      var tooltipContent = `
        <table class="tooltip-table">
          <tr><th>ID</th><td>${node.id}</td></tr>
          <tr><th>Type</th><td>${node.type}</td></tr>
          <tr><th>From</th><td>${node.From}</td></tr>
          <tr><th>To</th><td>${node.To}</td></tr>
        </table>`;
      var tooltip = document.createElement('div');
      tooltip.innerHTML = tooltipContent;
      tooltip.className = 'tooltip';
      tooltip.id = 'tooltip';
      document.body.appendChild(tooltip);

      document.onmousemove = function (e) {
        var x = e.clientX, y = e.clientY;
        tooltip.style.top = (y + 20) + 'px';
        tooltip.style.left = (x + 20) + 'px';
      };
    });

    network.on("blurNode", function (params) {
      var tooltip = document.getElementById('tooltip');
      if (tooltip) {
        tooltip.remove();
      }
      document.onmousemove = null;
    });

    network.on("hoverEdge", function (params) {
      var edge = edges.find(e => e.from === params.edge.from && e.to === params.edge.to);
      var tooltipContent = `
        <table class="tooltip-table">
          <tr><th>Vessel</th><td>${edge.Vessel}</td></tr>
          <tr><th>Next_NodeID</th><td>${edge.to}</td></tr>
          <tr><th>From_NodeID</th><td>${edge.from}</td></tr>
          <tr><th>DAYS</th><td>${edge.DAYS}</td></tr>
        </table>`;
      var tooltip = document.createElement('div');
      tooltip.innerHTML = tooltipContent;
      tooltip.className = 'tooltip';
      tooltip.id = 'tooltip';
      document.body.appendChild(tooltip);

      document.onmousemove = function (e) {
        var x = e.clientX, y = e.clientY;
        tooltip.style.top = (y + 20) + 'px';
        tooltip.style.left = (x + 20) + 'px';
      };
    });

    network.on("blurEdge", function (params) {
      var tooltip = document.getElementById('tooltip');
      if (tooltip) {
        tooltip.remove();
      }
      document.onmousemove = null;
    });

    // Set node colors based on type
    nodes.forEach(node => {
      switch (node.type) {
        case 'Load':
          node.color = '#eb4034';
          break;
        case 'Discharge':
          node.color = '#3155a8';
          break;
        case 'term_source':
          node.color = '#3da831';
          break;
        case 'canal(out)':
        case 'canal(in)':
          node.color = '#23a9dd';
          break;
        case 'term_sink':
          node.color = '#9a31a8';
          break;
        case 'fob':
          node.color = '#FFFF00';
          break;
        case 'purchase':
          node.color = '#C0C0C0';
          break;
        default:
          node.color = 'gray';
      }
    });

    // Update the dataset with the new colors
    data.nodes.update(nodes);

    // Log data to console for debugging
    console.log('Nodes:', nodes);
    console.log('Edges:', edges);
  </script>
</body>
</html>
